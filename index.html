<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Quafu-Docs</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Quafu document";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> Quafu-Docs
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href=".">Quafu document</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#execute-openqasm-directly">Execute openqasm directly</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#execute-circuit-and-measure-observables">Execute circuit and measure observables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#api-reference">API Reference</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#quafu">quafu</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#quafu.ExecResult">ExecResult</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_tools.ExecResult.calculate_obs">calculate_obs()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_tools.ExecResult.plot_amplitudes">plot_amplitudes()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#quafu.QuantumCircuit">QuantumCircuit</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.__init__">__init__()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.barrier">barrier()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.cnot">cnot()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.cy">cy()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.cz">cz()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.draw_circuit">draw_circuit()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.from_openqasm">from_openqasm()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.get_backend">get_backend()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.h">h()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.layered_circuit">layered_circuit()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.measure">measure()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.run">run()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.rx">rx()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.ry">ry()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.rz">rz()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.send">send()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.set_backend">set_backend()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.submit_task">submit_task()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.swap">swap()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.to_openqasm">to_openqasm()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.x">x()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.y">y()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quafu.quantum_circuit.QuantumCircuit.z">z()</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">Quafu-Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>Quafu document</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="quafu-document">Quafu document</h1>
<h2 id="installation">Installation</h2>
<p>Run following codes in command line</p>
<pre><code class="language-shell">git clone https://github.com/ScQ-Cloud/quafu
cd quafu
python setup.py install
</code></pre>
<h2 id="getting-started">Getting started</h2>
<p>Initialize a circuit with 5 qubits </p>
<pre><code class="language-python">import numpy as np
from quafu import QuantumCircuit

q = QuantumCircuit(4)
</code></pre>
<p>Add quantum gates, currently Quafu supports gates x, y, z, h, rx, ry, rz, cnot, cz, swap.</p>
<pre><code class="language-python">q.x(0)
q.x(1) 
q.cnot(2, 1) 
q.ry(1, np.pi/2) 
q.rx(2, np.pi) 
q.rz(3, 0.1) 
q.cz(2, 3) 
</code></pre>
<p>Add measurement information including qubits measured (measures), single shot number (shots) and classical bits keeping the measured results (cbits). If there is no measurement information provided, all qubits are measured by default.  </p>
<pre><code class="language-python">measures = [0, 1, 2, 3]
shots = 1000
cbits = [0, 1, 2, 3]
q.measure(measures, shots, cbits=cbits)
</code></pre>
<p>You can draw the circuit using the draw_circuit() method</p>
<pre><code class="language-python">q.draw_circuit()
</code></pre>
<pre><code>0 -----X-------------------------- M-&gt;c[0]

1 -----X-------+---Ry(1.571)------ M-&gt;c[1]
               |                  
2 -------------*---Rx(3.142)---*-- M-&gt;c[2]
                               Cz 
3 -Rz(0.100)-------------------+-- M-&gt;c[3]
</code></pre>
<p>Set experiment backend and send the quantum circuit. The default backend is "ScQ-P10". You can use the "compile" parameter to tell the backend whether compile the circuit. If you want to run the circuit directly on the backend, set "compile" to false.</p>
<pre><code class="language-python">q.set_backend(&quot;ScQ-P10&quot;)
res = q.send(compile=True)
</code></pre>
<p>You can use the returned results to check the count and amplitude on each measured bit string. The output bits are arranged as 0, 1, 2,... from left to the right.</p>
<pre><code class="language-python">print(res.counts) #counts
print(res.amplitudes) #amplitude
res.plot_amplitudes()
</code></pre>
<pre><code>{'0010': 10, '0111': 6, '1000': 16, '1010': 484, '1100': 9, '1101': 1, '1110': 473, '1111': 1}
{'0010': 0.01, '0111': 0.006, '1000': 0.016, '1010': 0.484, '1100': 0.009, '1101': 0.001, '1110': 0.473, '1111': 0.001}
</code></pre>
<p><img alt="png" src="quafu_document_files/quafu_document_11_1.png" /></p>
<h2 id="execute-openqasm-directly">Execute openqasm directly</h2>
<p>Quafu provides from_openqasm() function for initializing quantum circuit directly from openqasm.</p>
<pre><code class="language-python">q = QuantumCircuit(4)
test_ghz = &quot;&quot;&quot;OPENQASM 2.0;
include &quot;qelib1.inc&quot;;
qreg q[4];
h q[0];
cx q[0],q[1];
cx q[0],q[2];
cx q[0],q[3];
&quot;&quot;&quot;
q.from_openqasm(test_ghz)
q.draw_circuit()
res = q.send()
res.plot_amplitudes()
</code></pre>
<pre><code>0 -H---*----*----*-- M-&gt;c[0]
       |    |    |  
1 -----+----|----|-- M-&gt;c[1]
            |    |  
2 ----------+----|-- M-&gt;c[2]
                 |  
3 ---------------+-- M-&gt;c[3]
</code></pre>
<p><img alt="png" src="quafu_document_files/quafu_document_13_1.png" /></p>
<h2 id="execute-circuit-and-measure-observables">Execute circuit and measure observables</h2>
<p>Quafu provides measuring observables with an excuted quantum circuit. You can input Pauli operators that need to expectation values to the submit_task() function.
For example, you can input [["XYX", [0, 1, 2]], ["Z", [1]]] to calcuate the expectation of operators <script type="math/tex">\sigma^x_0\sigma^y_1\sigma^x_2</script> and <script type="math/tex">\sigma^z_1</script>.
The submit_task() function will minimize the executing times of the circuit with different measurement basis that can calculate all expectations of input operators. </p>
<p>Here we show how to measure the energy expection of the Ising chain
<script type="math/tex; mode=display">H=\sum_i \sigma^z_i \sigma^z_{i+1} + g \sum_i \sigma^x_i.</script>
</p>
<p>First we initialize a circuit with three Hadamard gate</p>
<pre><code class="language-python">q = QuantumCircuit(5)

for i in range(5):
    if i % 2 == 0:
        q.h(i)

q.draw_circuit()
measures = list(range(5))
q.measure(measures, 2000)

</code></pre>
<pre><code>0 -H- M-&gt;c[0]

1 --- M-&gt;c[1]

2 -H- M-&gt;c[2]

3 --- M-&gt;c[3]

4 -H- M-&gt;c[4]
</code></pre>
<p>Next we set operators that need to be measured to calculate the energy expectation, and submit the circuit using submit_task()</p>
<pre><code class="language-python">test_Ising = [[&quot;X&quot;, [i]] for i in range(5)]
test_Ising.extend([[&quot;ZZ&quot;, [i, i+1]] for i in range(4)])
res, obsexp = q.submit_task(test_Ising)
</code></pre>
<pre><code>Job start, need measured in  [['XXXXX', [0, 1, 2, 3, 4]], ['ZZZZZ', [0, 1, 2, 3, 4]]]
</code></pre>
<p>The function return measurement results and operator expectations. The measurement results only contain two ExecResult object since the circuit is only executed twice, with measurement basis  [['XXXXX', [0, 1, 2, 3, 4]] and ['ZZZZZ', [0, 1, 2, 3, 4]]] respectively.</p>
<pre><code class="language-python">
res[0].plot_amplitudes()
res[1].plot_amplitudes()

</code></pre>
<p><img alt="png" src="quafu_document_files/quafu_document_19_0.png" /></p>
<p><img alt="png" src="quafu_document_files/quafu_document_19_1.png" /></p>
<p>The return operator expectations (obsexp) is a list with a length equal to the input operator number. We can use it to calculate the energy expectation </p>
<pre><code class="language-python">print(obsexp)
g = 0.5
E = g*sum(obsexp[:5])+sum(obsexp[5:])
print(E)

</code></pre>
<pre><code>[0.9890000000000001, 0.010999999999999954, 0.9910000000000001, 0.016000000000000014, 0.9950000000000001, 0.05400000000000005, 0.04899999999999999, 0.02100000000000002, 0.019999999999999962]
1.645
</code></pre>
<h2 id="api-reference">API Reference</h2>


<div class="doc doc-object doc-module">


<a id="quafu"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="quafu.ExecResult" class="doc doc-heading">
        <code>ExecResult</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>

  
      <p>Class that save the execute results returned from backend.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Samples counts on each bitstring.</p></td>
        </tr>
        <tr>
          <td><code>amplitudes</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Calculated amplitudes on each bitstring.</p></td>
        </tr>
        <tr>
          <td><code>taskid</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Unique task id for the execute result.</p></td>
        </tr>
        <tr>
          <td><code>transpiled_circuit</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="quafu.quantum_circuit.QuantumCircuit" href="#quafu.QuantumCircuit">QuantumCircuit</a></code>
          </td>
          <td><p>Quantum circuit transpiled on backend.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>quafu\quantum_tools.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExecResult</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Class that save the execute results returned from backend.</span>
<span class="sd">    Attributes:</span>
<span class="sd">        counts (dict): Samples counts on each bitstring.</span>
<span class="sd">        amplitudes (dict): Calculated amplitudes on each bitstring.</span>
<span class="sd">        taskid (int): Unique task id for the execute result.</span>
<span class="sd">        transpiled_circuit (QuantumCircuit): Quantum circuit transpiled on backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">,</span> <span class="n">measures</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="n">measures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;res&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_res</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logicalq_res</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cbits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
           <span class="n">newkey</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cbits</span><span class="p">])</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">logicalq_res</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">taskid</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;task_id&#39;</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">transpiled_openqasm</span> <span class="o">=</span> <span class="n">input_dict</span><span class="p">[</span><span class="s2">&quot;openqasm&quot;</span><span class="p">]</span>
        <span class="kn">from</span> <span class="nn">.quantum_circuit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transpiled_circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transpiled_circuit</span><span class="o">.</span><span class="n">from_openqasm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transpiled_openqasm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_base</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span> <span class="o">=</span> <span class="p">{}</span> 
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">/</span><span class="n">total_counts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>


    <span class="k">def</span> <span class="nf">calculate_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate observables on input position</span>
<span class="sd">        Args: </span>
<span class="sd">            pos (list[int]): Positions of observalbes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">measure_obs</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logicalq_res</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">plot_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the amplitudes from execute results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bitstrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">amps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amps</span><span class="p">)),</span> <span class="n">amps</span><span class="p">,</span> <span class="n">tick_label</span> <span class="o">=</span> <span class="n">bitstrs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;amplitudes&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_tools.ExecResult.calculate_obs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">calculate_obs</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate observables on input position
Args: 
    pos (list[int]): Positions of observalbes.</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_tools.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate observables on input position</span>
<span class="sd">    Args: </span>
<span class="sd">        pos (list[int]): Positions of observalbes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">measure_obs</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logicalq_res</span><span class="p">)</span> 
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_tools.ExecResult.plot_amplitudes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_amplitudes</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Plot the amplitudes from execute results.</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_tools.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the amplitudes from execute results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bitstrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">amps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amplitudes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amps</span><span class="p">)),</span> <span class="n">amps</span><span class="p">,</span> <span class="n">tick_label</span> <span class="o">=</span> <span class="n">bitstrs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;amplitudes&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="quafu.QuantumCircuit" class="doc doc-heading">
        <code>QuantumCircuit</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>



        <details class="quote">
          <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">QuantumCircuit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a QuantumCircuit object</span>

<span class="sd">        Args:</span>
<span class="sd">            num (int): Total qubit number used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tomo</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;ScQ-P10&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_qubits</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">set_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select the quantum device for executing task. Different computing backends provide different gate set. </span>

<span class="sd">        Args:</span>
<span class="sd">            backend (str): Can be &quot;ScQ-P10&quot;, &quot;ScQ-P20&quot;, &quot;ScQ-P50&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>

    <span class="k">def</span> <span class="nf">get_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns: </span>
<span class="sd">            The backend used currently</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span>

    <span class="k">def</span> <span class="nf">get_used_qubits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layered_circuit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_qubits</span>

    <span class="k">def</span> <span class="nf">layered_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make layered circuit from the gate sequence self.gates.</span>

<span class="sd">        Returns: </span>
<span class="sd">            A layered list with left justed circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>
        <span class="n">gatelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span>
        <span class="n">gateQlist</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span>
        <span class="n">used_qubits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">gatelist</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">SingleQubitGate</span><span class="p">):</span>
                <span class="n">gateQlist</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
                    <span class="n">used_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">Barrier</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">TwoQubitGate</span><span class="p">):</span>
                <span class="n">pos1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="n">pos2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="n">gateQlist</span><span class="p">[</span><span class="n">pos1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">TwoQubitGate</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
                            <span class="n">used_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

                <span class="n">maxlayer</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">layerj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">layerj</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">layerj</span> <span class="o">==</span> <span class="n">maxlayer</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">layerj</span> <span class="o">-</span> <span class="n">maxlayer</span><span class="p">)):</span>
                            <span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">maxdepth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)])</span>

        <span class="k">for</span> <span class="n">gates</span> <span class="ow">in</span> <span class="n">gateQlist</span><span class="p">:</span>
            <span class="n">gates</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxdepth</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">gates</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
                <span class="n">used_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">used_qubits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">used_qubits</span><span class="p">)</span>

        <span class="n">new_gateQlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">old_qi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">)):</span>
            <span class="n">gates</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="p">[</span><span class="n">old_qi</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">old_qi</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
                <span class="n">new_gateQlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gates</span><span class="p">)</span>

        <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_gateQlist</span><span class="p">)</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">used_qubits</span><span class="p">,</span> <span class="n">lc</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span> <span class="o">=</span> <span class="n">lc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_qubits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">used_qubits</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span>

    <span class="k">def</span> <span class="nf">draw_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw layered circuit using ASCII, print in terminal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layered_circuit</span><span class="p">()</span>
        <span class="n">gateQlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">printlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">depth</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&lt;U30&quot;</span><span class="p">)</span>

        <span class="n">reduce_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)))</span>
        <span class="n">reduce_map_inv</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="n">gateQlist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
            <span class="n">layergates</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="p">[:,</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
                <span class="n">gate</span> <span class="o">=</span> <span class="n">layergates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedSingleQubitGate</span><span class="p">):</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ParaSingleQubitGate</span><span class="p">):</span>
                    <span class="n">gatestr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">)</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gatestr</span>
                    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gatestr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedTwoQubitGate</span><span class="p">):</span>
                    <span class="n">q1</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)]</span>
                    <span class="n">q2</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)]</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ControlGate</span><span class="p">):</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">ctrl</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">targ</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span>

                        <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="s2">&quot;CX&quot;</span><span class="p">]:</span>
                            <span class="n">printlist</span><span class="p">[</span><span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span>
                            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
                            <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                            <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                            <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                            <span class="n">printlist</span><span class="p">[</span><span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span>
                            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ParaTwoQubitGate</span><span class="p">):</span>
                    <span class="n">q1</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                    <span class="n">q2</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                    <span class="n">gatestr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                        <span class="n">gatestr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(&quot;</span> <span class="o">%</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="p">[</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">para</span> <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gatestr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">)</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gatestr</span>
                    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gatestr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">Barrier</span><span class="p">):</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reduce_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">q1</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">pos</span><span class="p">)]</span>
                    <span class="n">q2</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">)]</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;||&quot;</span>
                    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">))</span>

            <span class="n">printlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlen</span>

        <span class="n">circuitstr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">linestr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;q[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reduce_map_inv</span><span class="p">[</span><span class="n">j</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">printlist</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">printlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]),</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">reduce_map_inv</span><span class="p">[</span><span class="n">j</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">linestr</span> <span class="o">+=</span> <span class="s2">&quot; M-&gt;c[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">[</span><span class="n">reduce_map_inv</span><span class="p">[</span><span class="n">j</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]]</span>
                <span class="n">circuitstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">circuitstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">printlist</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">printlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]),</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)]))</span>
        <span class="n">circuitstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">circuitstr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">circuitstr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">from_openqasm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">openqasm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the circuit from openqasm text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">pi</span>
        <span class="kn">import</span> <span class="nn">re</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span> <span class="o">=</span> <span class="n">openqasm</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">measured_qubits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">global_valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">operations_qbs</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">operations</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;qreg&quot;</span><span class="p">:</span>
                    <span class="n">qbs</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">qbs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;creg&quot;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;measure&quot;</span><span class="p">:</span>
                    <span class="n">qbs</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">indstr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">qbs</span><span class="p">)</span>
                    <span class="n">inds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">indst</span><span class="p">)</span> <span class="k">for</span> <span class="n">indst</span> <span class="ow">in</span> <span class="n">indstr</span><span class="p">]</span>
                    <span class="n">mb</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cb</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">[</span><span class="n">mb</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
                    <span class="n">measured_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mb</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qbs</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">indstr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">qbs</span><span class="p">)</span>
                    <span class="n">inds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">indst</span><span class="p">)</span> <span class="k">for</span> <span class="n">indst</span> <span class="ow">in</span> <span class="n">indstr</span><span class="p">]</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">measured_qubits</span><span class="p">:</span>
                            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">global_valid</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>

                    <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;barrier&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">barrier</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sp_op</span> <span class="o">=</span> <span class="n">operations</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
                            <span class="n">gatename</span> <span class="o">=</span> <span class="n">sp_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp_op</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">paras</span> <span class="o">=</span> <span class="n">sp_op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;()&quot;</span><span class="p">)</span>
                                <span class="n">parastr</span> <span class="o">=</span> <span class="n">paras</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                                <span class="n">paras</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">parai</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="n">pi</span><span class="p">})</span> <span class="k">for</span> <span class="n">parai</span> <span class="ow">in</span> <span class="n">parastr</span><span class="p">]</span>

                            <span class="k">if</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;cx&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;cy&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;cz&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;swap&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;rx&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;ry&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;rz&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;u1&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;u2&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;u3&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;Warning: Operations </span><span class="si">%s</span><span class="s2"> may be not supported by QuantumCircuit class currently.&quot;</span> <span class="o">%</span> <span class="n">gatename</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">global_valid</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: All operations after measurement will be removed for executing on experiment&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_openqasm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the circuit to openqasm text.</span>
<span class="sd">        Returns: </span>
<span class="sd">            openqasm text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qasm</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;OPENQASM 2.0;</span><span class="se">\n</span><span class="s1">include &quot;qelib1.inc&quot;;</span><span class="se">\n</span><span class="s1">&#39;&#39;&#39;</span>
        <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;qreg q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>
        <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;creg meas[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedSingleQubitGate</span><span class="p">):</span>
                <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ParaSingleQubitGate</span><span class="p">):</span>
                <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">) q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedTwoQubitGate</span><span class="p">):</span>
                <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> q[</span><span class="si">%d</span><span class="s2">],q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span> <span class="o">==</span> <span class="n">Barrier</span><span class="p">:</span>
                <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;barrier &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;q[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">:</span>
            <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;measure q[</span><span class="si">%d</span><span class="s2">] -&gt; meas[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span> <span class="o">=</span> <span class="n">qasm</span>
        <span class="k">return</span> <span class="n">qasm</span>

    <span class="k">def</span> <span class="nf">submit_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obslist</span><span class="o">=</span><span class="p">[],</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the circuit with observable expectation measurement task.</span>
<span class="sd">        Args:</span>
<span class="sd">            obslist (list[str, list[int]]): List of pauli string and its position.</span>

<span class="sd">        Returns: </span>
<span class="sd">            List of executed results and list of measured observable</span>

<span class="sd">        Examples: </span>
<span class="sd">            1) input [[&quot;XYX&quot;, [0, 1, 2]], [&quot;Z&quot;, [1]]] measure pauli operator XYX at 0, 1, 2 qubit, and Z at 1 qubit.\n</span>
<span class="sd">            2) Measure 5-qubit Ising Hamiltonian we can use\n</span>
<span class="sd">            obslist = [[&quot;X&quot;, [i]] for i in range(5)]]\n</span>
<span class="sd">            obslist.extend([[&quot;ZZ&quot;, [i, i+1]] for i in range(4)])\n</span>

<span class="sd">        For the energy expectation of Ising Hamiltonian \n</span>
<span class="sd">        res, obsexp = q.submit_task(obslist)\n</span>
<span class="sd">        E = sum(obsexp)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># save input circuit</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span>
        <span class="n">measures</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No observable measurement task.&quot;</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="p">[]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obslist</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">measures</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CircuitError</span><span class="p">(</span><span class="s2">&quot;Qubit </span><span class="si">%d</span><span class="s2"> in observer </span><span class="si">%s</span><span class="s2"> is not measured.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="n">measure_basis</span><span class="p">,</span> <span class="n">targlist</span> <span class="o">=</span> <span class="n">merge_measure</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Job start, need measured in &quot;</span><span class="p">,</span> <span class="n">measure_basis</span><span class="p">)</span>

            <span class="n">exec_res</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">measure_base</span> <span class="ow">in</span> <span class="n">measure_basis</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">measure_base</span><span class="o">=</span><span class="n">measure_base</span><span class="p">,</span> <span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="n">inputs</span>
                <span class="n">exec_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

            <span class="n">measure_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">obi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)):</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">obslist</span><span class="p">[</span><span class="n">obi</span><span class="p">]</span>
                <span class="n">rpos</span> <span class="o">=</span> <span class="p">[</span><span class="n">measures</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">measure_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exec_res</span><span class="p">[</span><span class="n">targlist</span><span class="p">[</span><span class="n">obi</span><span class="p">]]</span><span class="o">.</span><span class="n">calculate_obs</span><span class="p">(</span><span class="n">rpos</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">exec_res</span><span class="p">,</span> <span class="n">measure_results</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measure_base</span><span class="o">=</span><span class="p">[],</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Single run for measurement task.</span>

<span class="sd">        Args:</span>
<span class="sd">            measure_base (list[str, list[int]]): measure base and it position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measure_base</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">measure_base</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">measure_base</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">measure_base</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">measure_base</span> <span class="o">=</span> <span class="n">measure_base</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the circuit on experimental device.</span>

<span class="sd">        Args:</span>
<span class="sd">            compile (bool): Whether compile the circuit on backend.</span>
<span class="sd">        Returns: </span>
<span class="sd">            ExecResult object that contain the dict return from quantum device.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_openqasm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span> <span class="o">=</span> <span class="nb">compile</span>
        <span class="n">backends</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ScQ-P10&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ScQ-P20&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ScQ-P50&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;qtasm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span><span class="p">,</span> <span class="s2">&quot;shots&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shots</span><span class="p">,</span> <span class="s2">&quot;qubits&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;scan&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;tomo&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tomo</span><span class="p">),</span> <span class="s2">&quot;selected_server&quot;</span><span class="p">:</span> <span class="n">backends</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">],</span>
                <span class="s2">&quot;compile&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">)}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://120.46.160.173/qbackend/scq_kit/&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded;charset=UTF-8&#39;</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%27&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5002</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Excessive computation scale.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5001</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Invalid Circuit.&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ExecResult</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hadamard gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): qubit the gate act.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        X gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): qubit the gate act.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Y gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): qubit the gate act.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">YGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Z gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): qubit the gate act.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ZGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">rx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">para</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Single qubit rotation Rx gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): qubit the gate act.</span>
<span class="sd">            para (float): rotation angle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">para</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RXGate</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">ry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">para</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Single qubit rotation Ry gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): qubit the gate act.</span>
<span class="sd">            para (float): rotation angle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">para</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RYGate</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">rz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">para</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Single qubit rotation Rz gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): qubit the gate act.</span>
<span class="sd">            para (float): rotation angle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">para</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RZGate</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">cnot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tar</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CNOT gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            ctrl (int): control qubit.</span>
<span class="sd">            tar (int): target qubit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CXGate</span><span class="p">([</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">cy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tar</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CY gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            ctrl (int): control qubit.</span>
<span class="sd">            tar (int): target qubit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CYGate</span><span class="p">([</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">cz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tar</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CZ gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            ctrl (int): control qubit.</span>
<span class="sd">            tar (int): target qubit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CZGate</span><span class="p">([</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># def fsim(self, q1, q2, theta, phi):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     fSim gate.</span>

    <span class="c1">#     Args:</span>
    <span class="c1">#         q1, q2 (int): qubits the gate act.</span>
    <span class="c1">#         theta (float): parameter theta in fSim. </span>
    <span class="c1">#         phi (float): parameter phi in fSim.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     self.gates.append(FsimGate([q1, q2], [theta, phi]))</span>

    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">q2</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWAP gate</span>

<span class="sd">        Args:</span>
<span class="sd">            q1 (int): qubit the gate act.</span>
<span class="sd">            q2 (int): qubit the gate act.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SwapGate</span><span class="p">([</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qlist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add barrier for qubits in qlist.</span>

<span class="sd">        Args:</span>
<span class="sd">            qlist (list[int]): A list contain the qubit need add barrier. When qlist contain at least two qubit, the barrier will be added from minimum qubit to maximum qubit. For example: barrier([0, 2]) create barrier for qubits 0, 1, 2. To create discrete barrier, using barrier([0]), barrier([2]).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Barrier</span><span class="p">(</span><span class="n">qlist</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">shots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">cbits</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">tomo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Measurement setting for experiment device.</span>

<span class="sd">        Args:</span>
<span class="sd">            pos (int): Qubits need measure.</span>
<span class="sd">            shots (int): Sampling number for outcome state.</span>
<span class="sd">            cbits (List[int]): Classical bits keeping the measure results.</span>
<span class="sd">            tomo (bool): Whether do tomography.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shots</span> <span class="o">=</span> <span class="n">shots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tomo</span> <span class="o">=</span> <span class="n">tomo</span>
        <span class="k">if</span> <span class="n">cbits</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cbits</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">cbits</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CircuitError</span><span class="p">(</span><span class="s2">&quot;Number of measured bits should equal to the number of classical bits&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">used_qubits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_used_qubits</span><span class="p">()</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">used_qubits</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">12</span>
        <span class="n">oper</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">qeye</span><span class="p">([</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">_operator</span><span class="p">(</span><span class="n">used_qubits</span><span class="p">)</span> <span class="o">*</span> <span class="n">oper</span>
        <span class="k">return</span> <span class="n">oper</span>

    <span class="k">def</span> <span class="nf">_simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;prob&#39;</span><span class="p">,</span> <span class="n">state_ini</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">oper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span><span class="p">()</span>
        <span class="n">used_qubits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_qubits</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">used_qubits</span><span class="p">)</span>
        <span class="n">measures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">measures</span> <span class="o">=</span> <span class="n">measures</span><span class="p">[:,</span> <span class="n">measures</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">measures</span> <span class="o">=</span> <span class="p">[</span><span class="n">used_qubits</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">measures</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">state_ini</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">basis</span><span class="p">([</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">num</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">Qobj</span><span class="p">(</span><span class="n">state_ini</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">num</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">num</span><span class="p">])</span>

        <span class="n">psi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span><span class="p">()</span> <span class="o">*</span> <span class="n">psi</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">qutip</span><span class="o">.</span><span class="n">ptrace</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">measures</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;prob&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rho</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;ket&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">rho</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;oper&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">result_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tomo&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">qutip</span><span class="o">.</span><span class="n">ket2dm</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unsupported `result_type`&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">num</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize a QuantumCircuit object</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>num</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Total qubit number used</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a QuantumCircuit object</span>

<span class="sd">    Args:</span>
<span class="sd">        num (int): Total qubit number used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tomo</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;ScQ-P10&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">used_qubits</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.barrier" class="doc doc-heading">
<code class="highlight language-python"><span class="n">barrier</span><span class="p">(</span><span class="n">qlist</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Add barrier for qubits in qlist.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>qlist</code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td><p>A list contain the qubit need add barrier. When qlist contain at least two qubit, the barrier will be added from minimum qubit to maximum qubit. For example: barrier([0, 2]) create barrier for qubits 0, 1, 2. To create discrete barrier, using barrier([0]), barrier([2]).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qlist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add barrier for qubits in qlist.</span>

<span class="sd">    Args:</span>
<span class="sd">        qlist (list[int]): A list contain the qubit need add barrier. When qlist contain at least two qubit, the barrier will be added from minimum qubit to maximum qubit. For example: barrier([0, 2]) create barrier for qubits 0, 1, 2. To create discrete barrier, using barrier([0]), barrier([2]).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Barrier</span><span class="p">(</span><span class="n">qlist</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.cnot" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cnot</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>CNOT gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ctrl</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>control qubit.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tar</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>target qubit.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cnot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tar</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CNOT gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        ctrl (int): control qubit.</span>
<span class="sd">        tar (int): target qubit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CXGate</span><span class="p">([</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">]))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.cy" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cy</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>CY gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ctrl</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>control qubit.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tar</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>target qubit.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tar</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CY gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        ctrl (int): control qubit.</span>
<span class="sd">        tar (int): target qubit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CYGate</span><span class="p">([</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">]))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.cz" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cz</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>CZ gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ctrl</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>control qubit.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tar</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>target qubit.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tar</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CZ gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        ctrl (int): control qubit.</span>
<span class="sd">        tar (int): target qubit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CZGate</span><span class="p">([</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">tar</span><span class="p">]))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.draw_circuit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">draw_circuit</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Draw layered circuit using ASCII, print in terminal.</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">draw_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw layered circuit using ASCII, print in terminal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layered_circuit</span><span class="p">()</span>
    <span class="n">gateQlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">printlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">depth</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;&lt;U30&quot;</span><span class="p">)</span>

    <span class="n">reduce_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)))</span>
    <span class="n">reduce_map_inv</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="n">gateQlist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
        <span class="n">layergates</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="p">[:,</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
            <span class="n">gate</span> <span class="o">=</span> <span class="n">layergates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedSingleQubitGate</span><span class="p">):</span>
                <span class="n">printlist</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span>
                <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ParaSingleQubitGate</span><span class="p">):</span>
                <span class="n">gatestr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">)</span>
                <span class="n">printlist</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gatestr</span>
                <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gatestr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedTwoQubitGate</span><span class="p">):</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)]</span>
                <span class="n">q2</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)]</span>
                <span class="n">printlist</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ControlGate</span><span class="p">):</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">ctrl</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                    <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">targ</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span>

                    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CNOT&quot;</span><span class="p">,</span> <span class="s2">&quot;CX&quot;</span><span class="p">]:</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span>
                        <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                        <span class="n">printlist</span><span class="p">[</span><span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span>
                        <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ParaTwoQubitGate</span><span class="p">):</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="n">q2</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="n">printlist</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                <span class="n">printlist</span><span class="p">[</span><span class="n">reduce_map</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
                <span class="n">gatestr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                    <span class="n">gatestr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(&quot;</span> <span class="o">%</span> <span class="n">gate</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">para</span> <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gatestr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">)</span>
                <span class="n">printlist</span><span class="p">[</span><span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">gatestr</span>
                <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gatestr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">Barrier</span><span class="p">):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reduce_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">pos</span><span class="p">)]</span>
                <span class="n">q2</span> <span class="o">=</span> <span class="n">reduce_map</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">)]</span>
                <span class="n">printlist</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q1</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;||&quot;</span>
                <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxlen</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">))</span>

        <span class="n">printlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlen</span>

    <span class="n">circuitstr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">linestr</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;q[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reduce_map_inv</span><span class="p">[</span><span class="n">j</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">printlist</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">printlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]),</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">reduce_map_inv</span><span class="p">[</span><span class="n">j</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">linestr</span> <span class="o">+=</span> <span class="s2">&quot; M-&gt;c[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">[</span><span class="n">reduce_map_inv</span><span class="p">[</span><span class="n">j</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]]</span>
            <span class="n">circuitstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linestr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">circuitstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">printlist</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">printlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="p">]),</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span><span class="p">)]))</span>
    <span class="n">circuitstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">circuitstr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">circuitstr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.from_openqasm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_openqasm</span><span class="p">(</span><span class="n">openqasm</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the circuit from openqasm text.</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_openqasm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">openqasm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the circuit from openqasm text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">pi</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span> <span class="o">=</span> <span class="n">openqasm</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">measured_qubits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">global_valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">operations_qbs</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">operations</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;qreg&quot;</span><span class="p">:</span>
                <span class="n">qbs</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">qbs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;creg&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;measure&quot;</span><span class="p">:</span>
                <span class="n">qbs</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">indstr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">qbs</span><span class="p">)</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">indst</span><span class="p">)</span> <span class="k">for</span> <span class="n">indst</span> <span class="ow">in</span> <span class="n">indstr</span><span class="p">]</span>
                <span class="n">mb</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">[</span><span class="n">mb</span><span class="p">]</span> <span class="o">=</span> <span class="n">cb</span>
                <span class="n">measured_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qbs</span> <span class="o">=</span> <span class="n">operations_qbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">indstr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">qbs</span><span class="p">)</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">indst</span><span class="p">)</span> <span class="k">for</span> <span class="n">indst</span> <span class="ow">in</span> <span class="n">indstr</span><span class="p">]</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">measured_qubits</span><span class="p">:</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">global_valid</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">operations</span> <span class="o">==</span> <span class="s2">&quot;barrier&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">barrier</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sp_op</span> <span class="o">=</span> <span class="n">operations</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
                        <span class="n">gatename</span> <span class="o">=</span> <span class="n">sp_op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sp_op</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">paras</span> <span class="o">=</span> <span class="n">sp_op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;()&quot;</span><span class="p">)</span>
                            <span class="n">parastr</span> <span class="o">=</span> <span class="n">paras</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="n">paras</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">parai</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="n">pi</span><span class="p">})</span> <span class="k">for</span> <span class="n">parai</span> <span class="ow">in</span> <span class="n">parastr</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;cx&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;cy&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;cz&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;swap&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;rx&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;ry&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;rz&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;u1&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;u2&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">gatename</span> <span class="o">==</span> <span class="s2">&quot;u3&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">paras</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;Warning: Operations </span><span class="si">%s</span><span class="s2"> may be not supported by QuantumCircuit class currently.&quot;</span> <span class="o">%</span> <span class="n">gatename</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">global_valid</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: All operations after measurement will be removed for executing on experiment&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.get_backend" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_backend</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns: 
    The backend used currently</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns: </span>
<span class="sd">        The backend used currently</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.h" class="doc doc-heading">
<code class="highlight language-python"><span class="n">h</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Hadamard gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hadamard gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): qubit the gate act.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.layered_circuit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">layered_circuit</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Make layered circuit from the gate sequence self.gates.</p>
<p>Returns: 
    A layered list with left justed circuit.</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">layered_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make layered circuit from the gate sequence self.gates.</span>

<span class="sd">    Returns: </span>
<span class="sd">        A layered list with left justed circuit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>
    <span class="n">gatelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span>
    <span class="n">gateQlist</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span>
    <span class="n">used_qubits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">gatelist</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">SingleQubitGate</span><span class="p">):</span>
            <span class="n">gateQlist</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
                <span class="n">used_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">Barrier</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">TwoQubitGate</span><span class="p">):</span>
            <span class="n">pos1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">pos2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">gateQlist</span><span class="p">[</span><span class="n">pos1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">TwoQubitGate</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
                        <span class="n">used_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">maxlayer</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">layerj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">layerj</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">layerj</span> <span class="o">==</span> <span class="n">maxlayer</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">layerj</span> <span class="o">-</span> <span class="n">maxlayer</span><span class="p">)):</span>
                        <span class="n">gateQlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">maxdepth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)])</span>

    <span class="k">for</span> <span class="n">gates</span> <span class="ow">in</span> <span class="n">gateQlist</span><span class="p">:</span>
        <span class="n">gates</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxdepth</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">gates</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
            <span class="n">used_qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">used_qubits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">used_qubits</span><span class="p">)</span>

    <span class="n">new_gateQlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">old_qi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gateQlist</span><span class="p">)):</span>
        <span class="n">gates</span> <span class="o">=</span> <span class="n">gateQlist</span><span class="p">[</span><span class="n">old_qi</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">old_qi</span> <span class="ow">in</span> <span class="n">used_qubits</span><span class="p">:</span>
            <span class="n">new_gateQlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gates</span><span class="p">)</span>

    <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_gateQlist</span><span class="p">)</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">used_qubits</span><span class="p">,</span> <span class="n">lc</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span> <span class="o">=</span> <span class="n">lc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">used_qubits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">used_qubits</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.measure" class="doc doc-heading">
<code class="highlight language-python"><span class="n">measure</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cbits</span><span class="o">=</span><span class="p">[],</span> <span class="n">tomo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Measurement setting for experiment device.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Qubits need measure.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>shots</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Sampling number for outcome state.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>cbits</code></td>
          <td>
                <code><span title="quafu.element_gates.List">List</span>[int]</code>
          </td>
          <td><p>Classical bits keeping the measure results.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>tomo</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether do tomography.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">shots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">cbits</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">tomo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Measurement setting for experiment device.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): Qubits need measure.</span>
<span class="sd">        shots (int): Sampling number for outcome state.</span>
<span class="sd">        cbits (List[int]): Classical bits keeping the measure results.</span>
<span class="sd">        tomo (bool): Whether do tomography.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">))))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shots</span> <span class="o">=</span> <span class="n">shots</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tomo</span> <span class="o">=</span> <span class="n">tomo</span>
    <span class="k">if</span> <span class="n">cbits</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cbits</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measures</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">cbits</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CircuitError</span><span class="p">(</span><span class="s2">&quot;Number of measured bits should equal to the number of classical bits&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">measure_base</span><span class="o">=</span><span class="p">[],</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Single run for measurement task.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>measure_base</code></td>
          <td>
                <code>list[str, list[int]]</code>
          </td>
          <td><p>measure base and it position.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measure_base</span><span class="o">=</span><span class="p">[],</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Single run for measurement task.</span>

<span class="sd">    Args:</span>
<span class="sd">        measure_base (list[str, list[int]]): measure base and it position.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measure_base</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">measure_base</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">measure_base</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">measure_base</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">measure_base</span> <span class="o">=</span> <span class="n">measure_base</span>

    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.rx" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rx</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Single qubit rotation Rx gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>para</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>rotation angle</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">para</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Single qubit rotation Rx gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): qubit the gate act.</span>
<span class="sd">        para (float): rotation angle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">para</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RXGate</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.ry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Single qubit rotation Ry gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>para</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>rotation angle</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">para</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Single qubit rotation Ry gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): qubit the gate act.</span>
<span class="sd">        para (float): rotation angle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">para</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RYGate</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.rz" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rz</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Single qubit rotation Rz gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>para</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>rotation angle</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">para</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Single qubit rotation Rz gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): qubit the gate act.</span>
<span class="sd">        para (float): rotation angle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">para</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RZGate</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">para</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.send" class="doc doc-heading">
<code class="highlight language-python"><span class="n">send</span><span class="p">(</span><span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Run the circuit on experimental device.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>compile</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether compile the circuit on backend.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns: 
    ExecResult object that contain the dict return from quantum device.</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the circuit on experimental device.</span>

<span class="sd">    Args:</span>
<span class="sd">        compile (bool): Whether compile the circuit on backend.</span>
<span class="sd">    Returns: </span>
<span class="sd">        ExecResult object that contain the dict return from quantum device.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">to_openqasm</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_compile</span> <span class="o">=</span> <span class="nb">compile</span>
    <span class="n">backends</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ScQ-P10&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ScQ-P20&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ScQ-P50&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;qtasm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span><span class="p">,</span> <span class="s2">&quot;shots&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shots</span><span class="p">,</span> <span class="s2">&quot;qubits&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="s2">&quot;scan&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;tomo&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tomo</span><span class="p">),</span> <span class="s2">&quot;selected_server&quot;</span><span class="p">:</span> <span class="n">backends</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">],</span>
            <span class="s2">&quot;compile&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compile</span><span class="p">)}</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://120.46.160.173/qbackend/scq_kit/&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded;charset=UTF-8&#39;</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%27&quot;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5002</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Excessive computation scale.&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;stat&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5001</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="s2">&quot;Invalid Circuit.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ExecResult</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.set_backend" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Select the quantum device for executing task. Different computing backends provide different gate set. </p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>backend</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Can be "ScQ-P10", "ScQ-P20", "ScQ-P50".</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_backend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select the quantum device for executing task. Different computing backends provide different gate set. </span>

<span class="sd">    Args:</span>
<span class="sd">        backend (str): Can be &quot;ScQ-P10&quot;, &quot;ScQ-P20&quot;, &quot;ScQ-P50&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">backend</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.submit_task" class="doc doc-heading">
<code class="highlight language-python"><span class="n">submit_task</span><span class="p">(</span><span class="n">obslist</span><span class="o">=</span><span class="p">[],</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Execute the circuit with observable expectation measurement task.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>obslist</code></td>
          <td>
                <code>list[str, list[int]]</code>
          </td>
          <td><p>List of pauli string and its position.</p></td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns: 
    List of executed results and list of measured observable</p>
<p>Examples: 
    1) input [["XYX", [0, 1, 2]], ["Z", [1]]] measure pauli operator XYX at 0, 1, 2 qubit, and Z at 1 qubit.</p>
<pre><code>2) Measure 5-qubit Ising Hamiltonian we can use

obslist = [["X", [i]] for i in range(5)]]

obslist.extend([["ZZ", [i, i+1]] for i in range(4)])
</code></pre>
<p>For the energy expectation of Ising Hamiltonian </p>
<p>res, obsexp = q.submit_task(obslist)</p>
<p>E = sum(obsexp)</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">submit_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obslist</span><span class="o">=</span><span class="p">[],</span> <span class="nb">compile</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the circuit with observable expectation measurement task.</span>
<span class="sd">    Args:</span>
<span class="sd">        obslist (list[str, list[int]]): List of pauli string and its position.</span>

<span class="sd">    Returns: </span>
<span class="sd">        List of executed results and list of measured observable</span>

<span class="sd">    Examples: </span>
<span class="sd">        1) input [[&quot;XYX&quot;, [0, 1, 2]], [&quot;Z&quot;, [1]]] measure pauli operator XYX at 0, 1, 2 qubit, and Z at 1 qubit.\n</span>
<span class="sd">        2) Measure 5-qubit Ising Hamiltonian we can use\n</span>
<span class="sd">        obslist = [[&quot;X&quot;, [i]] for i in range(5)]]\n</span>
<span class="sd">        obslist.extend([[&quot;ZZ&quot;, [i, i+1]] for i in range(4)])\n</span>

<span class="sd">    For the energy expectation of Ising Hamiltonian \n</span>
<span class="sd">    res, obsexp = q.submit_task(obslist)\n</span>
<span class="sd">    E = sum(obsexp)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># save input circuit</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span>
    <span class="n">measures</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No observable measurement task.&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="p">[]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obslist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">measures</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CircuitError</span><span class="p">(</span><span class="s2">&quot;Qubit </span><span class="si">%d</span><span class="s2"> in observer </span><span class="si">%s</span><span class="s2"> is not measured.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">obs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">measure_basis</span><span class="p">,</span> <span class="n">targlist</span> <span class="o">=</span> <span class="n">merge_measure</span><span class="p">(</span><span class="n">obslist</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Job start, need measured in &quot;</span><span class="p">,</span> <span class="n">measure_basis</span><span class="p">)</span>

        <span class="n">exec_res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">measure_base</span> <span class="ow">in</span> <span class="n">measure_basis</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">measure_base</span><span class="o">=</span><span class="n">measure_base</span><span class="p">,</span> <span class="nb">compile</span><span class="o">=</span><span class="nb">compile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="n">inputs</span>
            <span class="n">exec_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="n">measure_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obslist</span><span class="p">)):</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">obslist</span><span class="p">[</span><span class="n">obi</span><span class="p">]</span>
            <span class="n">rpos</span> <span class="o">=</span> <span class="p">[</span><span class="n">measures</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">obs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">measure_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exec_res</span><span class="p">[</span><span class="n">targlist</span><span class="p">[</span><span class="n">obi</span><span class="p">]]</span><span class="o">.</span><span class="n">calculate_obs</span><span class="p">(</span><span class="n">rpos</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">exec_res</span><span class="p">,</span> <span class="n">measure_results</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.swap" class="doc doc-heading">
<code class="highlight language-python"><span class="n">swap</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>SWAP gate</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>q1</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>q2</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">q2</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SWAP gate</span>

<span class="sd">    Args:</span>
<span class="sd">        q1 (int): qubit the gate act.</span>
<span class="sd">        q2 (int): qubit the gate act.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SwapGate</span><span class="p">([</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">]))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.to_openqasm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_openqasm</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convert the circuit to openqasm text.
Returns: 
    openqasm text.</p>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_openqasm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the circuit to openqasm text.</span>
<span class="sd">    Returns: </span>
<span class="sd">        openqasm text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qasm</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;OPENQASM 2.0;</span><span class="se">\n</span><span class="s1">include &quot;qelib1.inc&quot;;</span><span class="se">\n</span><span class="s1">&#39;&#39;&#39;</span>
    <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;qreg q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>
    <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;creg meas[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedSingleQubitGate</span><span class="p">):</span>
            <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">ParaSingleQubitGate</span><span class="p">):</span>
            <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">) q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gate</span><span class="o">.</span><span class="n">paras</span><span class="p">,</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">FixedTwoQubitGate</span><span class="p">):</span>
            <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> q[</span><span class="si">%d</span><span class="s2">],q[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gate</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">gate</span><span class="p">)</span> <span class="o">==</span> <span class="n">Barrier</span><span class="p">:</span>
            <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;barrier &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;q[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">gate</span><span class="o">.</span><span class="n">pos</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">:</span>
        <span class="n">qasm</span> <span class="o">+=</span> <span class="s2">&quot;measure q[</span><span class="si">%d</span><span class="s2">] -&gt; meas[</span><span class="si">%d</span><span class="s2">];</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measures</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">openqasm</span> <span class="o">=</span> <span class="n">qasm</span>
    <span class="k">return</span> <span class="n">qasm</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.x" class="doc doc-heading">
<code class="highlight language-python"><span class="n">x</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>X gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    X gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): qubit the gate act.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.y" class="doc doc-heading">
<code class="highlight language-python"><span class="n">y</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Y gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Y gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): qubit the gate act.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">YGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="quafu.quantum_circuit.QuantumCircuit.z" class="doc doc-heading">
<code class="highlight language-python"><span class="n">z</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Z gate.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pos</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>qubit the gate act.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>quafu\quantum_circuit.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Z gate.</span>

<span class="sd">    Args:</span>
<span class="sd">        pos (int): qubit the gate act.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ZGate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.3.0
Build Date UTC : 2022-08-04 13:44:28.468554+00:00
-->
