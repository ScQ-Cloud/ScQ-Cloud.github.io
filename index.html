<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>User guidence - PyQuafu-Docs</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "User guidence";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> PyQuafu-Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">PyQuafu</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href=".">User guidence</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#set-up-your-quafu-account">Set up your Quafu account</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#build-your-first-quantum-circuit">Build your first quantum circuit</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#submit-your-circuit">Submit your circuit</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#submit-circuit-and-measure-observables">Submit circuit and measure observables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#submit-task-asynchronously">Submit task asynchronously</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="apiref/">API reference</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">PyQuafu-Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>PyQuafu &raquo;</li><li>User guidence</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="user-guidence">User Guidence</h1>
<h2 id="installation">Installation</h2>
<p>Run following codes in command line</p>
<pre><code>pip install pyquafu 
</code></pre>
<p>or</p>
<pre><code class="language-shell">git clone https://github.com/ScQ-Cloud/pyquafu
cd quafu
python setup.py build
python setup.py install
</code></pre>
<h2 id="set-up-your-quafu-account">Set up your Quafu account</h2>
<p>To use the toolkit pyquafu, firstly you need to register on the <a href="http://quafu.baqis.ac.cn/">Quafu</a> website and get your apitoken <code>&lt;your API token&gt;</code>. If you already have an account, execute the follow code to set up your account.</p>
<pre><code class="language-python">from quafu import User
user = User()
user.save_apitoken(&lt;your API token&gt;)
</code></pre>
<p>You only need to save your token once and no longer need to execute above code when you use quafu after, except you want to change your account.</p>
<h2 id="build-your-first-quantum-circuit">Build your first quantum circuit</h2>
<p>Initialize a circuit with 5 qubits</p>
<pre><code class="language-python">import numpy as np
from quafu import QuantumCircuit

q = QuantumCircuit(5)
</code></pre>
<p>Add quantum gates. For quantum gates Quafu supports, please check the API reference for <a href="apiref/#quafu.QuantumCircuit"><code>QuantumCircuit</code></a></p>
<pre><code class="language-python">q.x(0)
q.x(1) 
q.cnot(2, 1) 
q.ry(1, np.pi/2) 
q.rx(2, np.pi) 
q.rz(3, 0.1) 
q.cz(2, 3) 
</code></pre>
<pre><code>&lt;quafu.circuits.quantum_circuit.QuantumCircuit at 0x1fa56e848b0&gt;
</code></pre>
<p>Add measurement information including qubits measured (<code>measures</code>) and the classical bits keeping the measured results (<code>cbits</code>). If there is no measurement information provided, all qubits are measured by default.  </p>
<pre><code class="language-python">measures = [0, 1, 2, 3]
cbits = [0, 1, 2, 3]
q.measure(measures,  cbits=cbits)
</code></pre>
<p>You can draw the circuit using the <a href="apiref/#quafu.circuits.quantum_circuit.QuantumCircuit.draw_circuit"><code>draw_circuit</code></a> method and use <code>width</code> parameter to adjust the length of the circuit.</p>
<pre><code class="language-python">q.draw_circuit(width=4)
</code></pre>
<pre><code>q[0]  ------X----------------------------- M-&gt;c[0]

q[1]  ------X--------+----RY(1.571)------- M-&gt;c[1]
                     |                    
q[2]  ---------------*----RX(3.142)----*-- M-&gt;c[2]
                                       |  
q[3]  --RZ(0.100)----------------------Z-- M-&gt;c[3]
</code></pre>
<p>You can also initial your quantum circuit with openqasm text. <a href="apiref/#quafu.QuantumCircuit"><code>QuantumCircuit</code></a> class provides the <a href="apiref/#quafu.circuits.quantum_circuit.QuantumCircuit.from_openqasm"><code>from_openqasm</code></a> method for initializing quantum circuit directly from openqasm.</p>
<pre><code class="language-python">qc = QuantumCircuit(4)
test_ghz = &quot;&quot;&quot;OPENQASM 2.0;
include &quot;qelib1.inc&quot;;
qreg q[4];
h q[0];
cx q[0],q[1];
cx q[0],q[2];
cx q[0],q[3];
&quot;&quot;&quot;
qc.from_openqasm(test_ghz)
qc.draw_circuit()
</code></pre>
<pre><code>q[0]  --H----*----*----*-- M-&gt;c[0]
             |    |    |  
q[1]  -------+----|----|-- M-&gt;c[1]
                  |    |  
q[2]  ------------+----|-- M-&gt;c[2]
                       |  
q[3]  -----------------+-- M-&gt;c[3]
</code></pre>
<h2 id="submit-your-circuit">Submit your circuit</h2>
<p>Now you are ready to submit the circuit to the experimental backend. First initial a Task object and load your account. </p>
<pre><code class="language-python">from quafu import Task
task = Task()
task.load_account()
</code></pre>
<p>You can configure your task properties using the <a href="apiref/#quafu.tasks.tasks.Task.config"><code>config</code></a> method. Here we choose the backend (<code>backend</code>) as <code>ScQ-P10</code>, the single shots number (<code>shots</code>) as 2000 and to compile the circuit on backend (<code>compile</code>).</p>
<pre><code class="language-python">task.config(backend=&quot;ScQ-P10&quot;, shots=2000, compile=True)
</code></pre>
<p>If you set the <code>compile</code> parameter to <code>False</code>, make sure that you know the topology of the backend well and submit valid circuit.</p>
<p>Send the quantum circuit to the backend. Here we send circuit <code>q</code>.</p>
<pre><code class="language-python">res = task.send(q)
</code></pre>
<p>You can use the returned results to check the count and amplitude on each measured bit string. The output bits are arranged as 0, 1, 2,... from left to the right.</p>
<pre><code class="language-python">
print(res.counts) #counts
print(res.amplitudes) #amplitude
res.plot_amplitudes()
</code></pre>
<pre><code>OrderedDict([('0010', 22), ('0011', 2), ('0110', 20), ('1000', 30), ('1001', 2), ('1010', 837), ('1011', 156), ('1100', 44), ('1110', 734), ('1111', 153)])
{'0010': 0.011, '0011': 0.001, '0110': 0.01, '1000': 0.015, '1001': 0.001, '1010': 0.4185, '1011': 0.078, '1100': 0.022, '1110': 0.367, '1111': 0.0765}
</code></pre>
<p><img alt="png" src="index_files/index_19_1.png" /></p>
<p>If you want to check the correctness the execute results. Quafu provide simple circuit similator based on sparse matrix.</p>
<pre><code class="language-python">from quafu import simulate
simu_res = simulate(q, output=&quot;amplitudes&quot;)
simu_res.plot_amplitudes(full=True)
</code></pre>
<p><img alt="png" src="index_files/index_21_0.png" /></p>
<p>You can also submit the 4-bit ghz circuit <code>qc</code> built from openqasm.</p>
<pre><code class="language-python">res = task.send(qc)
res.plot_amplitudes()

simu_res = simulate(qc)
simu_res.plot_amplitudes(full=True)
</code></pre>
<p><img alt="png" src="index_files/index_23_0.png" /></p>
<p><img alt="png" src="index_files/index_23_1.png" /></p>
<p>If you don't want to plot the results for basis with zero amplitudes, set the parameter <code>full</code> in method <a href="apiref/#quafu.results.results.SimuResult.plot_amplitudes"><code>plot_amplitudes</code></a> to False. Note that this parameter is only valid for results returned by simulator.  </p>
<h2 id="submit-circuit-and-measure-observables">Submit circuit and measure observables</h2>
<p>Quafu provides measuring observables with an excuted quantum circuit. You can input Pauli operators that need to measure expectation values to the <a href="apiref/#quafu.tasks.tasks.Task.submit"><code>submit</code></a> method.
For example, you can input [["XYX", [0, 1, 2]], ["Z", [1]]] to calcuate the expectation of operators <script type="math/tex">\sigma^x_0\sigma^y_1\sigma^x_2</script> and <script type="math/tex">\sigma^z_1</script>.
The <a href="apiref/#quafu.tasks.tasks.Task.submit"><code>submit</code></a> method will minimize the executing times of the circuit with different measurement basis that can calculate all expectations of input operators. </p>
<p>Here we show how to measure the energy expection of the Ising chain
<script type="math/tex; mode=display">H=\sum_i \sigma^z_i \sigma^z_{i+1} + g \sum_i \sigma^x_i.</script>
</p>
<p>First we initialize a circuit with three Hadamard gate</p>
<pre><code class="language-python">q = QuantumCircuit(5)

for i in range(5):
    if i % 2 == 0:
        q.h(i)

q.draw_circuit()
measures = list(range(5))
q.measure(measures)

</code></pre>
<pre><code>q[0]  -H- M-&gt;c[0]

q[1]  --- M-&gt;c[1]

q[2]  -H- M-&gt;c[2]

q[3]  --- M-&gt;c[3]

q[4]  -H- M-&gt;c[4]
</code></pre>
<p>Next we set operators that need to be measured to calculate the energy expectation, and submit the circuit using <a href="apiref/#quafu.tasks.tasks.Task.submit"><code>submit</code></a> method</p>
<pre><code class="language-python">test_Ising = [[&quot;X&quot;, [i]] for i in range(5)]
test_Ising.extend([[&quot;ZZ&quot;, [i, i+1]] for i in range(4)])
res, obsexp = task.submit(q, test_Ising)
</code></pre>
<pre><code>Job start, need measured in  [['XXXXX', [0, 1, 2, 3, 4]], ['ZZZZZ', [0, 1, 2, 3, 4]]]
</code></pre>
<p>The function return measurement results and operator expectations. The measurement results only contain two ExecResult object since the circuit is only executed twice, with measurement basis  [['XXXXX', [0, 1, 2, 3, 4]] and ['ZZZZZ', [0, 1, 2, 3, 4]]] respectively.</p>
<pre><code class="language-python">
res[0].plot_amplitudes()
res[1].plot_amplitudes()

</code></pre>
<p><img alt="png" src="index_files/index_29_0.png" /></p>
<p><img alt="png" src="index_files/index_29_1.png" /></p>
<p>The return operator expectations (<code>obsexp</code>) is a list with a length equal to the input operator number. We can use it to calculate the energy expectation </p>
<pre><code class="language-python">print(obsexp)
g = 0.5
E = g*sum(obsexp[:5])+sum(obsexp[5:])
print(E)

</code></pre>
<pre><code>[0.9930000000000001, -0.018000000000000016, 1.001, 0.03200000000000003, 1.001, 0.007000000000000006, 0.007000000000000006, -0.05800000000000005, -0.05800000000000005]
1.4024999999999999
</code></pre>
<h2 id="submit-task-asynchronously">Submit task asynchronously</h2>
<p>In the above examples, you have to wait for the result to return and cannot do other jobs continually. Now you can choose to set the parameter <code>wait</code> in <a href="apiref/#quafu.tasks.tasks.Task.send"><code>send</code></a> function to <code>false</code> to submit the task asynchronously and do not need it to return. When you need, you can retrieve the results at any time and check the status using the <a href="apiref/#quafu.tasks.tasks.Task.retrieve"><code>retrieve</code></a> function. Here, we use the example that measuring the qubit decoherence time <script type="math/tex">T_1</script> to show the detailed usage.</p>
<p>First initial a task</p>
<pre><code class="language-python">task = Task()
task.load_account()
task.config(backend=&quot;ScQ-S10&quot;, shots=2000, compile=True, priority=2)
</code></pre>
<p>Prepare parameters of a group of tasks and send the task asynchronously.</p>
<pre><code class="language-python">ts = range(0, 41, 4) #delay time list
names = [&quot;%dus&quot; %t for t in ts] #name list
for name, t in zip(names, ts): 
    q = QuantumCircuit(2)
    q.x(1)
    q.delay(1, t, unit=&quot;us&quot;)
    res = task.send(q, wait=False, name=name, group=&quot;Q1_T1&quot;)

</code></pre>
<p>Here the <code>delay</code> options will idle the target qubit <code>1</code> for a duration <code>t</code> in the time unit <code>us</code>(microsecond) and do nothing. In the send function, we set <code>wait</code> too false to execute the task asynchronously, give each task a name by duration time and set all tasks to a group named "Q1_T1".</p>
<p>Now we can try to retrieve the group of tasks using the <a href="apiref/#quafu.tasks.tasks.Task.retrieve_group"><code>retrieve_group</code></a> method.</p>
<pre><code class="language-python">group_res = task.retrieve_group(&quot;Q1_T1&quot;)
amps = [res.amplitudes[&quot;01&quot;] for res in group_res]
print(amps)  
</code></pre>
<pre><code>Group:  Q1_T1
task_id              task_name      status    
15FC712038B5CAAE     0us            Completed 
15FC71300DD50BD1     4us            Running   
15FC7130229491CF     8us            Completed 
15FC713036E64E56     12us           Completed 
15FC71400FBEAB8E     16us           In Queue  
15FC71401FECB2F0     20us           In Queue  
15FC714033B2CD5E     24us           In Queue  
15FC71500ED001E6     28us           In Queue  
15FC715020AF62C8     32us           In Queue  
15FC71503653E9C9     36us           In Queue  
15FC716010581117     40us           In Queue  
[0.9775, 0.7745, 0.722]
</code></pre>
<pre><code class="language-python">group_res = task.retrieve_group(&quot;Q1_T1&quot;)
</code></pre>
<pre><code>Group:  Q1_T1
task_id              task_name      status    
15FC712038B5CAAE     0us            Completed 
15FC71300DD50BD1     4us            Completed 
15FC7130229491CF     8us            Completed 
15FC713036E64E56     12us           Completed 
15FC71400FBEAB8E     16us           Completed 
15FC71401FECB2F0     20us           Completed 
15FC714033B2CD5E     24us           Completed 
15FC71500ED001E6     28us           Completed 
15FC715020AF62C8     32us           Completed 
15FC71503653E9C9     36us           Completed 
15FC716010581117     40us           Completed
</code></pre>
<p>Once all tasks are completed, we can do the next step.</p>
<pre><code class="language-python">print(amps)
import matplotlib.pyplot as plt
plt.plot(ts, amps, &quot;-o&quot;)
</code></pre>
<pre><code>[0.9775, 0.9045, 0.7745, 0.722, 0.4295, 0.5205, 0.561, 0.481, 0.5, 0.492, 0.4275]





[&lt;matplotlib.lines.Line2D at 0x1fe32568c10&gt;]
</code></pre>
<p><img alt="png" src="index_files/index_40_2.png" /></p>
<p>Note that task retrieving relies on the submit history saved in the <code>task</code> object. If your <code>task</code> object is changed or detroyed in the memory, you may get the wrong results. Suppose you have to close your program after submitting tasks, you need first save the history associated to the <code>task</code> object.</p>
<pre><code class="language-python">old_history = task.get_history() #get the history of task
#save the history to disk if you need!
#do save...

#retrieve the result using the `history` parameter with any Task() object
#do load...
newtask = Task()
newtask.load_account()
group_res = newtask.retrieve_group(&quot;Q1_T1&quot;, history=old_history)
</code></pre>
<pre><code>Group:  Q1_T1
task_id              task_name      status    
15FC712038B5CAAE     0us            Completed 
15FC71300DD50BD1     4us            Completed 
15FC7130229491CF     8us            Completed 
15FC713036E64E56     12us           Completed 
15FC71400FBEAB8E     16us           Completed 
15FC71401FECB2F0     20us           Completed 
15FC714033B2CD5E     24us           Completed 
15FC71500ED001E6     28us           Completed 
15FC715020AF62C8     32us           Completed 
15FC71503653E9C9     36us           Completed 
15FC716010581117     40us           Completed
</code></pre>
<p>Finally, you can also retrieve a single task using its unique <code>task_id</code>.</p>
<pre><code class="language-python">res_0us = newtask.retrieve(old_history[&quot;Q1_T1&quot;][0])
print(res_0us.amplitudes)
</code></pre>
<pre><code>{'01': 0.9775, '11': 0.0225}
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="apiref/" class="btn btn-neutral float-right" title="API reference">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="apiref/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
